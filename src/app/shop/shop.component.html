<div class="shop-container" *ngIf="currentRestaurant">

  <div class="resto-header" [style.backgroundImage]="'url(' + currentRestaurant.imageUrl + ')'">
    <div class="overlay">
      <div class="header-content">
        <h1>{{ currentRestaurant.name }}</h1>
        <div class="badges">
          <span class="badge">‚≠ê 4.5/5</span>
          <button class="btn-fav" (click)="toggleFavorite()">
            {{ isFavorite ? '‚ù§Ô∏è' : 'ü§ç' }}
          </button>
        </div>
        <p class="desc">{{ currentRestaurant.description }}</p>
      </div>
    </div>
  </div>

  <div class="filters-section">
    <div class="search-box">
      <input type="text" placeholder="üîç Rechercher un plat..."
             [(ngModel)]="searchTerm" (input)="applyFilters()">
    </div>

    <div class="categories-scroll">
      <button class="chip"
              [class.active]="selectedCategory === 'Tout'"
              (click)="selectCategory('Tout')">
        Tout
      </button>
      <button class="chip" *ngFor="let cat of uniqueCategories"
              [class.active]="selectedCategory === cat"
              (click)="selectCategory(cat)">
        {{ getEmoji(cat) }} {{ cat }}
      </button>
    </div>
  </div>

  <div class="products-grid">
    <div *ngFor="let product of displayedProducts" class="product-card">
      <div class="prod-info">
        <h3>{{ product.name }}</h3>
        <p class="prod-desc">{{ product.description }}</p>
        <span class="price">{{ product.price }} ‚Ç¨</span>
      </div>
      <div class="prod-action">
        <button class="btn-add" (click)="addToCart(product)">+</button>
      </div>
    </div>

    <div *ngIf="displayedProducts.length === 0" class="empty-state">
      <p>Aucun plat trouv√© pour cette recherche üò¢</p>
    </div>
  </div>

  <div class="sticky-cart" *ngIf="cartCount > 0" (click)="openCheckout()">
    <div class="cart-summary">
      <span class="count-badge">{{ cartCount }}</span>
      <span>Voir le panier</span>
    </div>
    <span class="total-price">{{ cartTotal }} ‚Ç¨</span>
  </div>

</div>

<div class="modal-overlay" *ngIf="showCheckoutModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Votre Panier üõí</h2>
      <button class="close-icon" (click)="closeCheckout()">‚úñ</button>
    </div>

    <div class="delivery-toggle">
      <button [class.active]="deliveryOption === 'pickup'" (click)="deliveryOption = 'pickup'">Emporter</button>
      <button [class.active]="deliveryOption === 'delivery'" (click)="deliveryOption = 'delivery'">Livraison (+2‚Ç¨)</button>
    </div>

    <div class="cart-items-preview">
      <p>Total √† payer : <strong>{{ cartTotal + (deliveryOption === 'delivery' ? 2 : 0) }} ‚Ç¨</strong></p>
    </div>

    <div class="form-group">
      <label>Une remarque ? (Sans oignons, code porte...)</label>
      <textarea [(ngModel)]="orderNote" rows="2" placeholder="Instructions sp√©ciales..."></textarea>
    </div>

    <hr class="divider">

    <div *ngIf="currentUser">
      <div class="user-welcome">
        <p>üëã <strong>{{ currentUser.email }}</strong></p>
        <small>Vos points de fid√©lit√© seront ajout√©s.</small>
      </div>
      <button class="btn-confirm" (click)="confirmOrder('USER')">
        Valider la commande
      </button>
    </div>

    <div *ngIf="!currentUser">

      <div class="register-prompt">
        <p>‚ú® Cr√©ez un compte pour suivre votre commande !</p>
        <button class="btn-outline" (click)="goToRegister()">Cr√©er mon compte</button>
      </div>

      <p class="or-text">- OU -</p>

      <div class="guest-form">
        <h4>Commande rapide (Invit√©)</h4>
        <input type="text" [(ngModel)]="guestName" placeholder="Votre Nom" class="input-field">
        <input type="tel" [(ngModel)]="guestPhone" placeholder="Votre T√©l√©phone" class="input-field">

        <button class="btn-confirm guest-btn" (click)="confirmOrder('GUEST')">
          Commander sans compte
        </button>
      </div>
    </div>

  </div>
</div>
