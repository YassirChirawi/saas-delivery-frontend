<div class="container mx-auto px-4 py-8">

  <div class="mb-6 relative">
    <div class="absolute left-4 top-3 text-gray-400">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
    </div>
    <input type="text" [(ngModel)]="searchTerm" (input)="onSearchChange()" placeholder="Plats, courses, lieux..."
      class="w-full py-3 pl-12 pr-4 rounded-full bg-gray-100 border-none focus:ring-0 text-gray-800 placeholder-gray-500 font-medium">
  </div>

  <div class="flex gap-3 overflow-x-auto pb-4 mb-6 no-scrollbar touch-pan-x">
    <!-- Static Filter: Tout -->
    <button (click)="selectCategory('')" class="flex flex-col items-center gap-2 min-w-[70px] transition-opacity"
      [class.opacity-100]="selectedCategory === ''" [class.opacity-50]="selectedCategory !== ''">
      <div class="w-14 h-14 rounded-xl bg-gray-100 flex items-center justify-center text-2xl shadow-sm">
        â™¾ï¸
      </div>
      <span class="text-xs font-bold text-gray-700">Tout</span>
    </button>

    <!-- Dynamic Filters -->
    <button *ngFor="let cat of categories" (click)="selectCategory(cat)"
      class="flex flex-col items-center gap-2 min-w-[70px] transition-opacity"
      [class.opacity-100]="selectedCategory === cat" [class.opacity-50]="selectedCategory !== cat">
      <div class="w-14 h-14 rounded-xl flex items-center justify-center text-2xl shadow-sm"
        [class.bg-gray-100]="selectedCategory !== cat" [class.bg-orange-100]="selectedCategory === cat">
        <!-- Mapping simple d'icÃ´nes basÃ© sur le nom (Ã  amÃ©liorer avec une map JS) -->
        <span *ngIf="cat === 'Burger'">ğŸ”</span>
        <span *ngIf="cat === 'Pizza'">ğŸ•</span>
        <span *ngIf="cat === 'Sushi'">ğŸ£</span>
        <span *ngIf="cat === 'Halal'">ğŸ–</span>
        <span *ngIf="cat === 'Dessert'">ğŸ°</span>
        <span *ngIf="!['Burger','Pizza','Sushi','Halal','Dessert'].includes(cat)">ğŸ½ï¸</span>
      </div>
      <span class="text-xs font-bold text-gray-700 whitespace-nowrap">{{ cat }}</span>
    </button>
  </div>


  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

    <div *ngFor="let resto of filteredRestaurants" (click)="goToShop(resto.id)"
      class="group bg-white rounded-xl shadow-sm overflow-hidden active:scale-95 transition-transform duration-200 cursor-pointer">

      <div class="relative h-36 md:h-48 w-full">
        <div class="absolute inset-0 bg-cover bg-center" [class.grayscale]="!isRestoOpen(resto)"
          [style.backgroundImage]="'url(' + (resto.imageUrl || 'assets/restaurant-bg.jpg') + ')'">
        </div>

        <!-- Status Badge overlay -->
        <div *ngIf="!isRestoOpen(resto)" class="absolute inset-0 bg-black/50 flex items-center justify-center">
          <span class="text-white text-xs font-bold px-2 py-1 bg-black/60 rounded">FERMÃ‰</span>
        </div>

        <!-- Favorite/Promo Icon placeholder -->
        <div class="absolute top-2 right-2 bg-white rounded-full p-1 shadow-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
          </svg>
        </div>
      </div>

      <div class="p-3">
        <div class="flex justify-between items-start">
          <h3 class="font-bold text-gray-900 truncate pr-2 text-base">{{ resto.name }}</h3>
          <div class="flex items-center gap-1 bg-gray-100 px-1.5 py-0.5 rounded-full">
            <span class="text-xs font-bold text-gray-800">4.5</span>
            <svg class="w-3 h-3 text-yellow-500 fill-current" viewBox="0 0 20 20">
              <path
                d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z" />
            </svg>
          </div>
        </div>

        <div class="flex items-center text-xs text-gray-500 mt-1 space-x-2">
          <span>$$ â€¢ {{ resto.tags[0] || 'GÃ©nÃ©ral' }}</span>
          <span>â€¢ {{ resto.deliveryFees ? resto.deliveryFees + ' DH' : 'Gratuit' }} livraison</span>
          <span class="text-gray-300">â€¢</span>
          <span class="text-green-600 font-medium">{{ resto.deliveryTime || '20-30 min' }}</span>
        </div>
      </div>

    </div>

  </div>

  <div *ngIf="filteredRestaurants.length === 0 && !isLoading" class="text-center py-20 animate-fade-in">
    <div class="text-6xl mb-4">ğŸ½ï¸</div>
    <p class="text-gray-500 text-lg">Aucun restaurant ne correspond Ã  votre recherche.</p>
    <button (click)="selectCategory(''); searchTerm=''" class="mt-4 text-orange-600 font-bold hover:underline">
      RÃ©initialiser les filtres
    </button>
  </div>

  <div *ngIf="isLoading" class="text-center py-20">
    <p class="text-gray-400 animate-pulse text-lg">Recherche des meilleures tables...</p>
  </div>

</div>